<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.sample.dao.HomeDao">

	<!-- 랜덤 모임 표시 -->
	<select id="randomMoims" resultType="MainDto">
		select
			a.moim_no		as moimNo,
			title			as title,
            user_id         as userId,
			join_count		as joinCount,
			head_count		as headCount,
			content			as content,
			image			as image,
			fee				as fee,
			likes			as likes,
			premium_yn		as premiumYn,
			delete_yn		as deleteYn,
			join_date		as joinDate,
			a.created_date	as createdDate,
			sub_cate_no		as subCateNo,
			location_no		as locationNo
		from
			moim_main A, moim_join_user B
        where
            b.user_role = 'ADMIN'
        and 
            a.moim_no = b.moim_no
        and
        	a.delete_yn = 'N'
		order by
		   DBMS_RANDOM.RANDOM
	</select>
	
	<!-- 지역 선호도 별로 표시 -->
	<select id="locationMoims" parameterType="long" resultType="MainDto">
       select 
			a.moim_no		as moimNo,
			title			as title,
			join_count		as joinCount,
			head_count		as headCount,
			content			as content,
			image			as image,
			fee				as fee,
			likes			as likes,
			premium_yn		as premiumYn,
			join_date		as joinDate,
			a.created_date	as createdDate,
			sub_cate_no		as subCateNo,
			a.location_no	as locationNo,
			b.name			as locationName
		from 
			moim_main A, moim_location B
		where
			a.location_no = b.location_no
        and
            a.location_no = #{value}
        and
        	a.delete_yn = 'N'
		order by
			dbms_random.random
	</select>
	
	<select id="favoliteMoims" parameterType="long" resultType="MainDto">
	
	<![CDATA[
	select * from(
    select 
			moim_no			as moimNo,
			title			as title,
			join_count		as joinCount,
			head_count		as headCount,
			content			as content,
			image			as image,
			fee				as fee,
			likes			as likes,
			premium_yn		as premiumYn,
			join_date		as joinDate,
			created_date	as createdDate,
			sub_cate_no		as subCateNo,
			location_no		as locationNo

		from 
			moim_main
		where
        	delete_yn = 'N'
		order by
			likes desc
	) where rownum <= 8
	]]>
	
	</select>
	
	<select id="mainCategoryMoims" parameterType="long" resultType="MainDto">
	 select * from(
	 	select 
			a.moim_no		as moimNo,
			title			as title,
			join_count		as joinCount,
			head_count		as headCount,
			content			as content,
			image			as image,
			fee				as fee,
			likes			as likes,
			premium_yn		as premiumYn,
			join_date		as joinDate,
			a.created_date	as createdDate,
			b.main_cate_no	as mainCateNo,
			c.sub_cate_no	as subCateNo,
			b.name			as mainCateName
		from 
			moim_main A, moim_main_category B, moim_sub_cate C
		where
			a.sub_cate_no = c.sub_cate_no and b.main_cate_no = c.main_cate_no
        and
            b.main_cate_no = #{value}
        and
        	a.delete_yn = 'N'
	 ) order by 
	 		dbms_random.random
	
	</select>
	
	<select id="joinedMoim" parameterType="string" resultType="MainDto">
	<![CDATA[
	select * from(
	select
		a.moim_no		as moimNo,
		title			as title,
		join_count		as joinCount,
		head_count		as headCount,
		content			as content,
		image			as image,
		fee				as fee,
		likes			as likes,
		premium_yn		as premiumYn,
		join_date		as joinDate,
		a.created_date	as createdDate,
		user_role		as userRole
	from 
		moim_join_user A ,moim_main B
	where 
		user_id = 'kwon'
	and 
		A.moim_no = B.moim_no
	and
        delete_yn = 'N'
	order by 
		join_date desc
	) where rownum <= 3
	]]>
	</select>
	
	<select id="followUsers" parameterType="string" resultType="MoimFollowDto">
	select
	A.user_id		as userId,
	A.fol_user_id	as folUserId,
	B.profile_image as image,
	B.nickname		as nickname
	
	from
		moim_follow A, moim_user B
	where
		A.user_id = #{value}
	and
		A.fol_user_id = B.user_id
	</select>
</mapper>